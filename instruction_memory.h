/*
 * instruction_memory.h
 *
 *  Created on: 25.04.2024
 *      Author: isd
 */

#include "systemc.h"

#ifndef INSTRUCTION_MEMORY_INSTRUCTION_MEMORY_H_
#define INSTRUCTION_MEMORY_INSTRUCTION_MEMORY_H_

SC_MODULE(instruction_memory) {
	sc_in<sc_lv<32> > read_address;
	sc_out<sc_lv<32> > instruction;
	sc_out<sc_lv<32> > last_instr_address;

	sc_lv<32> data_mem[32]= {
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",//mem 1
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",//mem 10
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",//mem 20
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",
			"00000000000000000000000000000000",//mem 30
			"00000000000000000000000000000000",
	};

	void behaviour() {
		last_instr_address.write(sc_lv<32>(31 * 4));
		if (read_address.read().to_int() >= 0) {
			int addr = ("0", read_address.read().range(31, 2)).to_int();
			instruction.write(data_mem[addr]);
		}
	}

	SC_CTOR(instruction_memory) {
		for(int i = 0; i < 32; ++i) {
			data_mem[i] = sc_lv<32>(SC_LOGIC_0);
		}
		data_mem[17] = sc_lv<32>("0000100000000000000000000010001");//J 17 (absolute jump to address 17)

		data_mem[18] = sc_lv<32>("0001000000000000000000000001001");//BEQ $0, $0, 9(relative jump/branc by 9 instruction

		data_mem[26] = sc_lv<32>("0000100000000000000000000011010");//J 26 (absolute jump to address 26)
	}
};

#endif /* INSTRUCTION_MEMORY_INSTRUCTION_MEMORY_H_ */
